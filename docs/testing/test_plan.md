# Roller - 测试计划

## 测试策略概述

Roller游戏的测试策略采用多层次测试方法，确保游戏在iPhone Safari浏览器上的稳定性、性能和用户体验。测试将涵盖单元测试、集成测试、性能测试和用户体验测试等多个方面。

## 测试环境

### 设备矩阵

| 设备类型 | 操作系统版本 | 浏览器 | 屏幕尺寸 |
|---------|------------|--------|---------|
| iPhone 13 Pro | iOS 15.0+ | Safari | 6.1" |
| iPhone 12 | iOS 14.0+ | Safari | 6.1" |
| iPhone SE (2022) | iOS 15.0+ | Safari | 4.7" |
| iPhone 11 | iOS 14.0+ | Safari | 6.1" |
| iPad Pro | iOS 15.0+ | Safari | 11" |

### 网络条件

- 高速WiFi (50+ Mbps)
- 标准4G网络 (10-20 Mbps)
- 弱网环境 (3G, 1-5 Mbps)
- 间歇性连接

## 测试类型

### 1. 单元测试

针对独立组件和功能模块的测试。

**测试工具**：Jest

**测试范围**：
- 核心游戏逻辑
- 物理计算函数
- 数学工具函数
- 资源加载器
- 存储管理器

**测试指标**：
- 代码覆盖率 > 80%
- 所有关键功能模块都有测试用例

### 2. 集成测试

测试多个组件之间的交互。

**测试工具**：Jest + JSDOM

**测试范围**：
- 游戏初始化流程
- 关卡加载和渲染
- 物理系统与渲染系统集成
- UI与游戏状态交互

### 3. 端到端测试

模拟真实用户场景的完整测试。

**测试工具**：Cypress

**测试范围**：
- 游戏完整流程
- 菜单导航
- 关卡选择和加载
- 游戏胜利条件

### 4. 性能测试

评估游戏在不同条件下的性能表现。

**测试工具**：自定义性能监控工具 + Chrome DevTools

**测试指标**：
- 帧率 (FPS) > 50
- 初始加载时间 < 5秒
- 内存使用 < 100MB
- 输入响应延迟 < 100ms

### 5. 兼容性测试

确保游戏在所有目标设备上正常运行。

**测试范围**：
- 不同iPhone型号
- 不同iOS版本
- 横屏/竖屏模式
- 不同屏幕分辨率

### 6. 可访问性测试

确保游戏符合Web内容无障碍指南(WCAG)。

**测试工具**：axe-core, 手动测试

**测试范围**：
- 颜色对比度
- 键盘导航
- 屏幕阅读器兼容性
- 替代控制方式

## 测试用例

### 单元测试用例示例

1. **物理引擎测试**
   - 测试小球在斜面上的加速度计算
   - 测试碰撞检测准确性
   - 测试摩擦力对小球速度的影响

2. **设备方向控制测试**
   - 测试设备方向数据转换为力向量的准确性
   - 测试方向数据平滑过滤算法
   - 测试校准功能

3. **关卡管理测试**
   - 测试关卡加载和解析
   - 测试胜利条件检测
   - 测试关卡重置功能

### 集成测试用例示例

1. **游戏初始化流程**
   - 测试资源加载和场景设置
   - 测试物理世界初始化
   - 测试UI系统与游戏状态同步

2. **输入系统与物理引擎集成**
   - 测试设备方向变化对小球运动的影响
   - 测试触摸输入的备选控制方式

### 端到端测试用例示例

1. **完整游戏流程**
   - 从主菜单开始游戏
   - 完成第一关卡
   - 查看结果屏幕
   - 进入下一关卡

2. **错误处理流程**
   - 测试网络连接中断的恢复机制
   - 测试设备方向传感器不可用时的备选方案

## 测试自动化

### 持续集成流程

1. 每次代码提交触发自动化测试
2. 单元测试和集成测试在CI环境中运行
3. 生成测试覆盖率报告
4. 性能基准测试在特定设备上运行

### 自动化测试脚本

```javascript
// 示例：小球物理测试
describe('Ball Physics', () => {
  let physicsWorld;
  let ball;
  
  beforeEach(() => {
    physicsWorld = new PhysicsWorld();
    ball = physicsWorld.createSphere({
      radius: 0.5,
      mass: 1,
      position: { x: 0, y: 0, z: 0 }
    });
  });
  
  test('应用重力时小球应该下落', () => {
    const initialY = ball.position.y;
    physicsWorld.setGravity({ x: 0, y: -9.8, z: 0 });
    
    // 模拟经过1秒
    physicsWorld.step(1);
    
    expect(ball.position.y).toBeLessThan(initialY);
  });
  
  test('碰撞检测应准确识别墙壁碰撞', () => {
    // 创建墙壁
    const wall = physicsWorld.createBox({
      size: { x: 10, y: 1, z: 10 },
      position: { x: 0, y: -1, z: 0 },
      isStatic: true
    });
    
    // 设置小球初始位置和速度
    ball.position.set(0, 2, 0);
    ball.velocity.set(0, -5, 0);
    
    let collisionDetected = false;
    physicsWorld.onCollision((bodyA, bodyB) => {
      if ((bodyA === ball && bodyB === wall) || 
          (bodyA === wall && bodyB === ball)) {
        collisionDetected = true;
      }
    });
    
    // 模拟足够时间让小球落到墙上
    physicsWorld.step(1);
    
    expect(collisionDetected).toBe(true);
    expect(ball.position.y).toBeGreaterThanOrEqual(-0.5); // 不应穿过墙壁
  });
});
```

## 测试数据管理

### 测试关卡数据

创建专用于测试的简化关卡：
- 基础关卡：简单平面迷宫
- 物理测试关卡：包含各种斜面和障碍物
- 性能测试关卡：包含大量物体以测试性能极限

### 模拟设备方向数据

创建标准化的设备方向数据序列，用于测试小球控制：
- 水平静止状态
- 向左倾斜序列
- 向右倾斜序列
- 复杂的多方向倾斜序列

## 缺陷跟踪与管理

### 缺陷优先级定义

| 优先级 | 描述 | 响应时间 |
|-------|------|---------|
| P0 - 阻断 | 阻止游戏运行或造成数据丢失的严重问题 | 立即修复 |
| P1 - 高 | 影响主要功能但有临时解决方案的问题 | 1-2天内修复 |
| P2 - 中 | 影响次要功能或有明显变通方法的问题 | 下一迭代修复 |
| P3 - 低 | 小的UI问题或非关键功能的小缺陷 | 根据优先级安排 |

### 缺陷报告模板

```
标题: [简短描述问题]

环境:
- 设备: [设备型号]
- iOS版本: [iOS版本号]
- 浏览器: [浏览器版本]
- 游戏版本: [游戏版本号]

重现步骤:
1. [详细步骤1]
2. [详细步骤2]
3. [详细步骤3]

预期结果:
[描述预期行为]

实际结果:
[描述实际行为]

附件:
[截图/视频/日志]

优先级: [P0-P3]
```

## 测试里程碑

| 阶段 | 测试重点 | 完成标准 |
|------|---------|---------|
| 原型测试 | 核心物理机制和设备控制 | 小球控制响应灵敏，物理效果真实 |
| Alpha测试 | 基本游戏循环和第一个关卡 | 可以完成一个完整关卡，无阻断性问题 |
| Beta测试 | 完整游戏流程和多个关卡 | 所有关卡可玩，性能达标，无严重问题 |
| 发布候选测试 | 兼容性和性能优化 | 所有目标设备上运行流畅，无已知严重问题 |
| 发布后测试 | 用户反馈和性能监控 | 收集真实用户数据，准备后续更新 |

## 风险评估与缓解

| 风险 | 影响 | 可能性 | 缓解策略 |
|------|------|-------|---------|
| 设备方向API兼容性问题 | 高 | 中 | 实现备选控制方案；全面测试目标设备 |
| 3D性能在低端设备上不佳 | 高 | 高 | 实现自适应渲染质量；优化3D资源 |
| 物理计算导致电池消耗过快 | 中 | 高 | 优化物理更新频率；简化物理模型 |
| 离线功能在某些浏览器上不工作 | 中 | 中 | 全面测试Service Worker；提供优雅降级方案 |
| 设备方向控制不够精确 | 高 | 中 | 实现校准功能；提供灵敏度调节 |
