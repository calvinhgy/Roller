# Roller - Prompt Driven Development 文档

## 项目概述

Roller是一款基于Web技术开发的3D滚珠游戏，专为iPhone用户设计。玩家通过倾斜设备来控制小球在3D迷宫中的移动，目标是将小球成功引导至终点。游戏可在iPhone自带的Safari浏览器中运行，无需安装。

## 开发方法论

本项目采用Prompt Driven Development (PDD)方法论，通过明确的提示和指导来驱动开发过程。PDD强调在编写代码前充分定义需求、架构和测试标准，确保开发团队对项目有清晰一致的理解。

## 核心提示(Prompts)

### 1. 产品愿景提示

```
创建一个名为"Roller"的3D滚珠游戏，专为iPhone用户设计，可在Safari浏览器中运行。
游戏应利用设备的倾斜角度来控制小球在迷宫中的滚动，提供真实的物理体验。
当玩家成功将小球引导至迷宫终点时，即为胜利。
游戏应具有视觉吸引力、易于上手但具有挑战性，并能在各种iPhone型号上流畅运行。
```

### 2. 技术架构提示

```
使用Three.js作为3D渲染引擎，Cannon.js作为物理引擎。
实现模块化架构，将游戏核心、物理系统、渲染系统、UI系统和关卡系统解耦。
利用DeviceOrientation API获取设备方向数据，并将其转换为物理世界中的力。
实现PWA功能，支持离线游戏和主屏幕安装。
优化性能以确保在各种iPhone设备上保持60FPS的流畅体验。
```

### 3. 用户体验提示

```
设计直观的用户界面，最小化学习曲线。
提供简短的教程关卡，引导玩家了解基本控制和游戏机制。
实现平滑的设备方向控制，应用适当的数据过滤以减少抖动。
提供视觉和听觉反馈，增强游戏沉浸感。
设计递进的难度曲线，保持玩家的挑战性和参与度。
实现成就系统，鼓励重复游玩和技能提升。
```

### 4. 性能优化提示

```
实现自适应渲染质量，根据设备性能调整细节级别。
优化3D模型和纹理，减少多边形数量和纹理大小。
实现资源的异步加载和缓存策略。
优化物理计算，对远离视图的对象暂停模拟。
使用对象池减少垃圾回收，避免运行时内存分配。
实现帧率监控和自动性能调整机制。
```

### 5. 测试策略提示

```
实现全面的单元测试，覆盖核心游戏逻辑和物理计算。
进行设备兼容性测试，确保在所有目标iPhone型号上正常运行。
执行性能基准测试，确保帧率、加载时间和内存使用符合要求。
进行用户测试，收集关于控制灵敏度和游戏难度的反馈。
实现自动化测试流程，集成到CI/CD管道中。
测试离线功能和网络中断恢复机制。
```

## 开发阶段与里程碑

### 阶段1: 概念验证(PoC)

**目标**: 验证核心技术可行性

**关键提示**:
```
实现基本的3D场景渲染和物理模拟。
验证设备方向控制机制的响应性和准确性。
测试基本的碰撞检测和物理反应。
评估性能基准，确定优化方向。
```

**验收标准**:
- 能够在iPhone Safari浏览器中渲染3D场景
- 设备倾斜能够控制小球移动
- 基本物理效果(重力、碰撞)正常工作
- 帧率保持在50FPS以上

### 阶段2: 核心游戏开发

**目标**: 实现完整的游戏循环和基础功能

**关键提示**:
```
实现完整的游戏状态管理(开始、暂停、结束)。
开发关卡加载和管理系统。
实现基本UI界面和导航流程。
添加音效和基本视觉效果。
优化设备方向控制，提高响应性和准确性。
```

**验收标准**:
- 完整的游戏循环可正常运行
- 至少3个可玩关卡
- 基本UI界面功能正常
- 设备方向控制灵敏且准确

### 阶段3: 内容与体验优化

**目标**: 丰富游戏内容，优化用户体验

**关键提示**:
```
设计并实现更多样化的关卡(至少10个)。
添加游戏元素(收集物、障碍物、特殊地形)。
实现进度保存和成就系统。
优化视觉效果和音效。
实现教程和帮助系统。
```

**验收标准**:
- 10个以上设计良好的关卡
- 游戏元素丰富多样
- 进度保存功能正常工作
- 视觉和听觉体验提升

### 阶段4: 性能优化与兼容性

**目标**: 确保在所有目标设备上的流畅体验

**关键提示**:
```
实现自适应渲染质量系统。
优化资源加载和内存管理。
进行全面的设备兼容性测试。
实现离线功能和PWA支持。
优化电池使用和热管理。
```

**验收标准**:
- 在所有目标iPhone型号上保持60FPS
- 加载时间不超过5秒
- 离线模式功能正常
- 电池消耗合理

### 阶段5: 发布准备

**目标**: 准备游戏发布

**关键提示**:
```
进行最终的质量保证测试。
优化首次加载体验。
实现数据分析和错误报告机制。
准备发布材料(截图、描述)。
进行最终用户测试和反馈收集。
```

**验收标准**:
- 无严重bug或崩溃问题
- 所有计划功能正常工作
- 用户测试反馈积极
- 发布材料准备完毕

## 开发指南

### 代码风格与标准

遵循以下提示进行开发:

```
使用ES6+语法和模块化设计。
遵循面向对象编程原则，使用类和继承。
使用JSDoc风格注释所有类、方法和复杂逻辑。
避免全局变量，使用模块封装。
使用常量存储配置值，避免硬编码。
遵循一致的命名约定(PascalCase用于类，camelCase用于方法和变量)。
```

### 性能优化指南

遵循以下提示进行性能优化:

```
使用对象池减少垃圾回收。
实现视锥体剔除，只渲染可见对象。
使用层级细节(LOD)技术，根据距离调整模型复杂度。
优化物理计算，对远离视图的对象降低更新频率。
使用纹理图集减少绘制调用。
实现资源的异步加载和预加载策略。
使用WebGL优化技术，如实例化渲染和合并几何体。
```

### 测试指南

遵循以下提示进行测试:

```
为所有核心功能编写单元测试。
使用模拟数据测试设备方向控制。
创建专用测试关卡验证物理和碰撞系统。
使用性能监控工具测量帧率、内存使用和加载时间。
在多种网络条件下测试资源加载和离线功能。
在所有目标设备上进行兼容性测试。
收集用户测试反馈，特别关注控制灵敏度和游戏难度。
```

## 开发工作流

### 特性开发流程

1. **特性定义**:
   - 基于产品需求创建详细的特性提示
   - 定义验收标准和测试用例

2. **设计与规划**:
   - 创建技术设计文档
   - 确定实现策略和依赖关系

3. **实现**:
   - 遵循代码标准进行开发
   - 编写单元测试

4. **测试与验证**:
   - 执行单元测试和集成测试
   - 验证特性是否满足验收标准

5. **代码审查**:
   - 进行代码审查，确保质量和一致性
   - 解决审查中发现的问题

6. **合并与部署**:
   - 合并到开发分支
   - 部署到测试环境进行验证

### 迭代计划

每个迭代(2周)应包含以下活动:

1. **迭代规划**:
   - 选择要实现的特性和修复的bug
   - 创建详细的任务分解

2. **日常开发**:
   - 每日站会同步进度和阻碍
   - 遵循特性开发流程

3. **迭代审查**:
   - 演示完成的特性
   - 收集反馈和改进建议

4. **迭代回顾**:
   - 讨论成功经验和改进机会
   - 调整开发流程和实践

## 风险管理

### 已识别风险

1. **设备方向API兼容性**:
   - 风险: Safari浏览器对DeviceOrientation API的支持可能变化
   - 缓解: 实现备选控制方案，持续监控API变化

2. **性能瓶颈**:
   - 风险: 复杂关卡可能导致性能下降
   - 缓解: 实现自适应渲染质量，优化物理计算

3. **用户体验一致性**:
   - 风险: 不同设备上的控制灵敏度可能不一致
   - 缓解: 实现设备特定的校准和灵敏度调整

4. **离线功能限制**:
   - 风险: Safari对Service Worker的支持有限制
   - 缓解: 实现优雅降级，确保核心功能在所有条件下可用

### 风险监控

定期审查以下指标:

- 设备兼容性测试结果
- 性能监控数据
- 用户反馈和评价
- Safari浏览器更新和API变化

## 结论

Roller项目采用Prompt Driven Development方法论，通过明确的提示和指导来驱动开发过程。本文档提供了项目的核心提示、开发阶段、工作流程和风险管理策略，为开发团队提供清晰的指导和参考。

通过遵循这些提示和指南，我们将创建一个高质量、流畅且引人入胜的3D滚珠游戏，为iPhone用户提供优质的游戏体验。
